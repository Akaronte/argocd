version: '3.7'

services:
  argocd-server:
    image: argoproj/argocd:latest
    container_name: argocd-server
    ports:
      - "8080:8080"  # Argo CD UI
    environment:
      - KUBECONFIG=/app/config/kubeconfig.yaml
      - KUBERNETES_MASTER=https://dummy.local
    volumes:
      - ./kubeconfig.dummy.yaml:/app/config/kubeconfig.yaml
    command:
      - argocd-server
      - --insecure
    depends_on:
      - argocd-repo-server
      - argocd-redis

  argocd-repo-server:
    image: argoproj/argocd:latest
    container_name: argocd-repo-server
    command:
      - argocd-repo-server

  argocd-redis:
    image: redis:alpine
    container_name: argocd-redis
    ports:
      - "6379:6379"

volumes:
  redis-data: